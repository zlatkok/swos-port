#include "mainMenu.h"
#include "menu.h"
#include "replays.h"
#include "main.mnu.h"

void activateMainMenu()
{
    activateMenu(&mainMenu);
}

static void drawExitIcon()
{
    static const unsigned char kExitIconData[] = {
        0x1e, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03,
        0x00, 0x00, 0x00, 0x02, 0x02, 0x01, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x0d, 0x0d, 0x09, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02,
        0x02, 0x01, 0x09, 0x03, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x0d, 0x09, 0x09, 0x09, 0x09, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x02, 0x09, 0x03,
        0x03, 0x03, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x06, 0x06, 0x0c, 0x0c, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x09, 0x03, 0x03, 0x03, 0x03,
        0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x06,
        0x05, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x03, 0x03, 0x03, 0x03, 0x03, 0x02, 0x00,
        0x00, 0x00, 0x00, 0x0f, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x05, 0x05, 0x02,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x03, 0x03, 0x03, 0x03, 0x03, 0x02, 0x00, 0x00, 0x00,
        0x0f, 0x06, 0x08, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x06, 0x03, 0x02, 0x03, 0x03, 0x02, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x02, 0x03, 0x03, 0x03, 0x03, 0x03, 0x02, 0x00, 0x00, 0x02, 0x0f, 0x06,
        0x06, 0x05, 0x05, 0x05, 0x04, 0x04, 0x00, 0x00, 0x00, 0x02, 0x03, 0x02, 0x03, 0x02, 0x00, 0x00,
        0x00, 0x00, 0x02, 0x03, 0x03, 0x03, 0x03, 0x03, 0x02, 0x00, 0x00, 0x0f, 0x0f, 0x0f, 0x06, 0x06,
        0x05, 0x05, 0x05, 0x04, 0x08, 0x00, 0x00, 0x03, 0x03, 0x03, 0x03, 0x06, 0x05, 0x00, 0x00, 0x00,
        0x02, 0x03, 0x03, 0x03, 0x03, 0x03, 0x02, 0x00, 0x00, 0x00, 0x0f, 0x06, 0x08, 0x08, 0x08, 0x08,
        0x08, 0x08, 0x08, 0x00, 0x00, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x03,
        0x03, 0x03, 0x03, 0x03, 0x02, 0x00, 0x00, 0x00, 0x00, 0x0f, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x05, 0x06, 0x06, 0x06, 0x0f, 0x03, 0x00, 0x00, 0x00, 0x02, 0x03, 0x03, 0x03,
        0x09, 0x02, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x06, 0x04, 0x05, 0x04, 0x0f, 0x03, 0x00, 0x00, 0x00, 0x02, 0x03, 0x03, 0x09, 0x02, 0x02,
        0x01, 0x09, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f,
        0x0f, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x02, 0x09, 0x01, 0x02, 0x02, 0x01, 0x07, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03, 0x08,
        0x00, 0x00, 0x08, 0x08, 0x08, 0x00, 0x02, 0x02, 0x02, 0x01, 0x07, 0x09, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x08, 0x08, 0x08, 0x08,
        0x08, 0x08, 0x08, 0x00, 0x09, 0x01, 0x07, 0x07, 0x09, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03,
        0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x08,
        0x08, 0x08
    };

    int x = D1.asInt() + 1;
    int y = D2.asInt();
    int width = kExitIconData[0];
    int height = kExitIconData[1];
    auto data = &kExitIconData[2];

    auto dest = swos.linAdr384k + y * kMenuScreenWidth + x;
    auto pitch = kMenuScreenWidth - width;

    while (height--) {
        for (int i = 0; i < width; i++, dest++, data++)
            if (*data)
                *dest = *data;

        dest += pitch;
    }
}


constexpr char kQuitToOS[] = "QUIT TO "
#ifdef _WIN32
"WINDOWS";
#elif defined(__ANDROID__)
"ANDROID";
#else
# error "Define OS name"
#endif

#include "quit.mnu.h"

static void showQuitMenu()
{
    showMenu(quitMenu);
    CommonMenuExit();
}

static void quitMenuOnInit()
{
    FadeOutToBlack();
    DrawMenu();     // redraw menu so it's ready for the fade-in
    FadeIn();
    swos.skipFade = -1;
}

static void quitGame()
{
    SAFE_INVOKE(FadeOutToBlack);
    std::exit(EXIT_SUCCESS);
}

static void returnToGame()
{
    SAFE_INVOKE(FadeOutToBlack);
    SetExitMenuFlag();
    swos.menuFade = 1;
}
